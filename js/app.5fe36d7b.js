(function(e){function t(t){for(var o,n,a=t[0],l=t[1],u=t[2],d=0,h=[];d<a.length;d++)n=a[d],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&h.push(i[n][0]),i[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);c&&c(t);while(h.length)h.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],o=!0,a=1;a<r.length;a++){var l=r[a];0!==i[l]&&(o=!1)}o&&(s.splice(t--,1),e=n(n.s=r[0]))}return e}var o={},i={app:0},s=[];function n(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=o,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var c=l;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"1d26":function(e,t,r){},2542:function(e,t,r){},"2a13":function(e,t,r){"use strict";r("c4a2")},3174:function(e,t,r){"use strict";r("2542")},"56d7":function(e,t,r){"use strict";r.r(t);var o=r("2b0e"),i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],n=(r("3174"),r("2877")),a={},l=Object(n["a"])(a,i,s,!1,null,null,null),u=l.exports,c=(r("e9f5"),r("a732"),r("8c4f")),d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container container"},[t("h1",[e._v(e._s("login"===e.mode?"登录":"注册"))]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"username"}},[e._v("用户名")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",id:"username",placeholder:"请输入用户名"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[e._v("密码")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",id:"password",placeholder:"请输入密码"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn",on:{click:e.handleSubmit}},[e._v(e._s("login"===e.mode?"登录":"注册"))]),"login"===e.mode&&e.biometricsAvailable?t("button",{staticClass:"btn biometric",on:{click:e.handleBiometricLogin}},[e._v(" 使用生物识别登录 ")]):e._e()]),t("p",{staticClass:"mode-switch"},[e._v(" "+e._s("login"===e.mode?"没有账号？":"已有账号？")+" "),t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleMode.apply(null,arguments)}}},[e._v(e._s("login"===e.mode?"注册":"登录"))])]),"register"===e.mode&&1===e.registrationStep?t("div",[t("button",{staticClass:"btn",on:{click:e.registerBiometrics}},[e._v("注册生物识别")])]):e._e(),e.error?t("div",{staticClass:"error-message"},[e._v(" "+e._s(e.error)+" ")]):e._e(),t("div",[e._v("版本号 1.0")])])},h=[],p=(r("d9e2"),r("14d9"),r("e1f2")),m=r("bc3a"),g=r.n(m);const v=g.a.create({baseURL:"https://mock-be.vercel.app/api",headers:{"Content-Type":"application/json"}});var f={name:"Login",data(){return{mode:"login",username:"",password:"",userId:"",error:null,biometricsAvailable:!1,registrationStep:0,loading:!1}},mounted(){this.checkBiometricsAvailability()},methods:{toggleMode(){this.mode="login"===this.mode?"register":"login",this.error=null,this.registrationStep=0},async checkBiometricsAvailability(){try{this.biometricsAvailable=window.PublicKeyCredential&&"undefined"!==typeof window.PublicKeyCredential&&"function"===typeof window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable,console.log("WebAuthn支持:",this.biometricsAvailable),this.biometricsAvailable&&(this.biometricsAvailable=await window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable())}catch(e){console.error("Error checking biometrics availability:",e),this.biometricsAvailable=!1}},async handleSubmit(){if(this.username&&this.password){this.loading=!0,this.error=null;try{if("login"===this.mode){const e=await v.post("/auth/login",{username:this.username,password:this.password}),t=e.data.user||{id:e.data.userId||1,username:this.username};this.userId=t.id,this.$store.dispatch("login",t),this.$router.push("/home")}else{const e=await v.post("/auth/register",{username:this.username,password:this.password});console.log("注册成功:",e.data),this.userId=e.data.userId,this.registrationStep=1}}catch(i){var e,t,r,o;this.error=(null===(e=i.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===(r=i.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.error)||i.message||"操作失败，请重试",console.error("API错误:",i)}finally{this.loading=!1}}else this.error="请输入用户名和密码"},async registerBiometrics(){if(this.biometricsAvailable){this.loading=!0,this.error=null;try{const e=navigator.userAgent,t=/android/i.test(e);console.log("设备信息:",{userAgent:e,isAndroid:t,platform:navigator.platform,vendor:navigator.vendor});const r=await v.post("/auth/generate-registration-options",{username:this.username,userId:this.userId}),o=r.data;let s;console.log("Registration options received:",JSON.stringify(o)),t&&(o.authenticatorSelection={...o.authenticatorSelection,authenticatorAttachment:"platform",requireResidentKey:!1,userVerification:"preferred"},console.log("Modified options for Android:",o.authenticatorSelection));try{const e=Object(p["b"])(o),t=new Promise((e,t)=>{setTimeout(()=>t(new Error("WebAuthn registration timed out after 30 seconds")),3e4)});s=await Promise.race([e,t]),console.log("Registration response received:",s)}catch(i){if(console.error("Registration specific error:",i),"NotReadableError"===i.name)throw new Error("设备凭证管理器出现问题。请确保您的设备已设置锁屏密码或生物识别，并重试。");throw i}const n=await v.post("/auth/verify-registration",{userId:this.userId,attestationResponse:s,origin:window.location.origin}),a=n.data.user||{id:n.data.userId||1,username:this.username};this.$store.dispatch("login",a),this.$router.push("/home")}catch(s){var e,t,r,o;console.error("生物识别注册错误 (详细):",s);let i="生物识别注册失败";"AbortError"===s.name?i="您取消了生物识别注册过程":"NotAllowedError"===s.name?i="操作被浏览器阻止或用户取消":"SecurityError"===s.name?i="安全错误：确保您在安全环境(HTTPS)下使用此功能":"NotSupportedError"===s.name&&(i="您的设备不支持所请求的生物识别功能"),this.error=(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===(r=s.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.error)||s.message||i}finally{this.loading=!1}}else this.error="您的设备不支持生物识别"},async handleBiometricLogin(){if(this.username){this.loading=!0,this.error=null;try{const e=await v.post("/auth/generate-authentication-options",{username:this.username}),t=e.data;console.log("Authentication options received:",JSON.stringify(t));const r=await Object(p["a"])(t),o=await v.post("/auth/verify-authentication",{username:this.username,assertionResponse:r,origin:window.location.origin}),i=o.data.user||{id:o.data.userId||1,username:this.username};this.$store.dispatch("login",i),this.$router.push("/home")}catch(i){var e,t,r,o;console.error("生物识别登录错误 (详细):",i),this.error=(null===(e=i.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===(r=i.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.error)||i.message||"生物识别登录失败"}finally{this.loading=!1}}else this.error="请先输入用户名"}}},b=f,w=(r("bd79"),Object(n["a"])(b,d,h,!1,null,"4785a3be",null)),y=w.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home container"},[t("h1",[e._v("欢迎, "+e._s(e.username))]),t("p",[e._v("这是你的主页")]),t("div",{staticClass:"user-info"},[t("h3",[e._v("用户信息")]),t("p",[e._v("用户ID: "+e._s(e.user.id))]),t("p",[e._v("用户名: "+e._s(e.user.username))])]),t("button",{staticClass:"btn logout-btn",on:{click:e.logout}},[e._v("登出")])])},A=[],S={name:"Home",computed:{user(){return this.$store.getters.getUser||{}},username(){return this.user.username||"用户"}},methods:{logout(){this.$store.dispatch("logout"),this.$router.push("/")}}},E=S,O=(r("2a13"),Object(n["a"])(E,_,A,!1,null,"1d4b27b3",null)),P=O.exports,C=r("2f62");o["a"].use(C["a"]);var j=new C["a"].Store({state:{user:null,authReady:!1},getters:{isAuthenticated:e=>!!e.user,getUser:e=>e.user},mutations:{SET_USER(e,t){e.user=t},SET_AUTH_READY(e,t){e.authReady=t}},actions:{login({commit:e},t){e("SET_USER",t),localStorage.setItem("user",JSON.stringify(t))},logout({commit:e}){e("SET_USER",null),localStorage.removeItem("user")},initAuth({commit:e}){const t=localStorage.getItem("user");t&&e("SET_USER",JSON.parse(t)),e("SET_AUTH_READY",!0)}}});o["a"].use(c["a"]);const k=[{path:"/",name:"Login",component:y,meta:{guest:!0}},{path:"/home",name:"Home",component:P,meta:{requiresAuth:!0}}],I=new c["a"]({mode:"hash",base:"",routes:k});I.beforeEach((e,t,r)=>{e.matched.some(e=>e.meta.requiresAuth)?j.getters.isAuthenticated?r():r({path:"/"}):e.matched.some(e=>e.meta.guest)&&j.getters.isAuthenticated?r({path:"/home"}):r()});var R=I,T=r("9483");Object(T["a"])("service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}}),o["a"].config.productionTip=!1,new o["a"]({router:R,store:j,render:e=>e(u)}).$mount("#app")},bd79:function(e,t,r){"use strict";r("1d26")},c4a2:function(e,t,r){}});
//# sourceMappingURL=app.5fe36d7b.js.map